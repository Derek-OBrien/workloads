name: Trigger Build for Application

on:
    workflow_dispatch:
    push:
        branches: [main]
    pull_request:
        branches: [main]

jobs:
    changes:
        name: Get Changes
        runs-on: ubuntu-latest
        permissions:
            pull-requests: read
        outputs:
            node: ${{ steps.changes.outputs.node }}
            node2: ${{ steps.changes.outputs.node2 }}
            java: ${{ steps.changes.outputs.java }}
            python: ${{ steps.changes.outputs.python }}
        steps:
            - uses: dorny/paths-filter@v3
              id: changes
              with:
                filters: |
                    node:
                        - 'node/**'
                    node2:
                        - 'node2/**'
                    java:
                        - 'java/**'
                    python:
                        - 'python/**'

    build-node:
        name: Build For Node 
        needs: changes
        if: ${{ needs.changes.outputs.node == 'true' }}
        uses: ./.github/workflows/build-node.yaml
        with:
            proj-path: node

    build-node2:
        name: Build For Node 2
        needs: changes
        if: ${{ needs.changes.outputs.node2 == 'true' }}
        uses: ./.github/workflows/build-node.yaml
        with:
            proj-path: node2
    
    build-java:
        name: Build For Java
        needs: changes
        if: ${{ needs.changes.outputs.java == 'true' }}
        uses: ./.github/workflows/build-java.yaml
        with:
            proj-path: java

    build-python:
        name: Build For Python
        needs: changes
        if: ${{ needs.changes.outputs.python == 'true' }}
        uses: ./.github/workflows/build-python.yaml
        with:
            proj-path: python